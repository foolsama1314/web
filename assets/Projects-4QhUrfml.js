import{_ as te,u as ae,r as c,o as oe,c as V,a as b,z as I,d as g,b as o,g as m,e as re,w as r,f as v,F as j,i as C,E as p,j as se,k as u,t as _,A as N,B as de}from"./index-o71zQlQf.js";const ne={class:"projects"},ie={class:"page-header"},ue={class:"header-actions"},pe={key:0,class:"filter-section"},ce={key:2,class:"projects-list"},ve={class:"projects-grid"},fe={class:"card-header"},me={class:"project-description"},ge={class:"project-meta"},ye={class:"card-actions"},be={__name:"Projects",setup(Ve){const q=se(),{isAuthenticated:W}=ae(),n=c([]),x=c([]),P=c(!0),w=c(!1),k=c(!1),S=c(""),D=c(""),T=c("date-desc"),$=c(["Web开发","移动应用","人工智能","大数据","区块链","物联网","游戏开发","其他"]),z=c([{label:"按日期降序",value:"date-desc"},{label:"按日期升序",value:"date-asc"},{label:"按标题升序",value:"title-asc"},{label:"按标题降序",value:"title-desc"}]),d=c({title:"",description:"",author:"",date:"",category:"Web开发",isPinned:!1,githubUrl:""}),s=c({id:0,title:"",githubUrl:"",description:"",author:"",date:"",category:"Web开发",isPinned:!1}),U=c(null),O=c(null),B={title:[{required:!0,message:"请输入项目标题",trigger:"blur"}],description:[{required:!0,message:"请输入项目描述",trigger:"blur"}],author:[{required:!0,message:"请输入作者姓名",trigger:"blur"}],date:[{required:!0,message:"请输入日期",trigger:"blur"}],category:[{required:!0,message:"请选择项目分类",trigger:"blur"}]},A=async()=>{P.value=!0;try{const a=await fetch("/api/projects");if(!a.ok)throw new Error("Failed to fetch projects");const e=await a.json();n.value=e,x.value=[...e],P.value=!1}catch(a){console.error("Failed to load projects:",a),p.error("加载项目失败！");const e=[{id:1,title:"基于Vue3的毕业设计管理系统",description:"这是一个基于Vue3 + Element Plus开发的毕业设计管理系统，包含项目展示、分类筛选、搜索等功能。",author:"foolsama",date:"2025-12-01",category:"Web开发",isPinned:!1,githubUrl:""},{id:2,title:"智能推荐算法研究与实现",description:"基于机器学习的智能推荐系统，使用协同过滤算法实现个性化推荐。",author:"foolsama",date:"2025-11-28",category:"人工智能",isPinned:!1,githubUrl:""},{id:3,title:"移动端健康管理APP",description:"使用React Native开发的健康管理应用，包含步数统计、饮食记录等功能。",author:"foolsama",date:"2025-11-25",category:"移动应用",isPinned:!1,githubUrl:""},{id:4,title:"大数据分析平台",description:"基于Hadoop生态系统的大数据分析平台，支持数据清洗、分析和可视化。",author:"foolsama",date:"2025-11-20",category:"大数据",isPinned:!1,githubUrl:""},{id:5,title:"区块链溯源系统",description:"基于区块链技术的商品溯源系统，确保商品信息的真实性和不可篡改性。",author:"foolsama",date:"2025-11-15",category:"区块链",isPinned:!1,githubUrl:""},{id:6,title:"物联网智能家居系统",description:"基于物联网技术的智能家居系统，支持远程控制和自动化场景设置。",author:"foolsama",date:"2025-11-10",category:"物联网",isPinned:!1,githubUrl:""}];n.value=e,x.value=[...e],P.value=!1}},y=()=>{let a=[...n.value];if(S.value){const e=S.value.toLowerCase();a=a.filter(t=>t.title.toLowerCase().includes(e)||t.description.toLowerCase().includes(e))}switch(D.value&&(a=a.filter(e=>e.category===D.value)),a.sort((e,t)=>e.isPinned&&!t.isPinned?-1:!e.isPinned&&t.isPinned?1:0),T.value){case"date-desc":a.sort((e,t)=>e.isPinned!==t.isPinned?e.isPinned?-1:1:new Date(t.date)-new Date(e.date));break;case"date-asc":a.sort((e,t)=>e.isPinned!==t.isPinned?e.isPinned?-1:1:new Date(e.date)-new Date(t.date));break;case"title-asc":a.sort((e,t)=>e.isPinned!==t.isPinned?e.isPinned?-1:1:e.title.localeCompare(t.title));break;case"title-desc":a.sort((e,t)=>e.isPinned!==t.isPinned?e.isPinned?-1:1:t.title.localeCompare(e.title));break}x.value=a},H=a=>{q.push(`/project/${a}`)},G=a=>{const e=n.value.findIndex(t=>t.id===a);e!==-1&&(n.value[e].isPinned=!n.value[e].isPinned,y(),p.success(n.value[e].isPinned?"项目顶置成功！":"项目取消顶置成功！"))},J=async()=>{if(!U.value){p.error("表单引用错误！");return}try{await U.value.validate();const a={...d.value,author:"foolsama",date:d.value.date?d.value.date.toISOString().split("T")[0]:new Date().toISOString().split("T")[0]},e=await fetch("/api/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!e.ok)throw new Error("Failed to add project");const t=await e.json();n.value.push(t),y(),w.value=!1,p.success("项目添加成功！"),d.value={title:"",description:"",author:"",date:"",category:"Web开发",githubUrl:""},U.value.resetFields()}catch(a){if(console.error("Error adding project:",a),a.name==="ValidationError")p.error("表单验证失败，请检查输入内容！");else{p.error(`项目添加失败：${a.message}`);const e=Math.max(...n.value.map(i=>i.id),0)+1,t={...d.value,id:e,author:"foolsama",date:d.value.date?d.value.date.toISOString().split("T")[0]:new Date().toISOString().split("T")[0]};n.value.push(t),y(),w.value=!1,p.success("项目添加成功！(本地模式)"),d.value={title:"",description:"",author:"",date:"",category:"Web开发",githubUrl:""},U.value.resetFields()}}},Q=a=>{s.value={...a,date:new Date(a.date),githubUrl:a.githubUrl||""},k.value=!0},K=async()=>{if(!O.value){p.error("表单引用错误！");return}try{await O.value.validate();const a={...s.value,author:"foolsama",date:s.value.date?s.value.date.toISOString().split("T")[0]:new Date().toISOString().split("T")[0]},e=await fetch(`/api/projects/${s.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!e.ok)throw new Error("Failed to update project");const t=await e.json(),i=n.value.findIndex(h=>h.id===t.id);i!==-1&&(n.value[i]=t,y()),k.value=!1,p.success("项目更新成功！")}catch(a){if(console.error("Error updating project:",a),a.name==="ValidationError")p.error("表单验证失败，请检查输入内容！");else{p.error(`项目更新失败：${a.message}`);const e=n.value.findIndex(t=>t.id===s.value.id);e!==-1&&(n.value[e]={...s.value,author:"foolsama",date:s.value.date?s.value.date.toISOString().split("T")[0]:new Date().toISOString().split("T")[0]},y()),k.value=!1,p.success("项目更新成功！(本地模式)")}}},X=async a=>{try{if(await de.confirm("确定要删除这个项目吗？删除后无法恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),!(await fetch(`/api/projects/${a}`,{method:"DELETE"})).ok)throw new Error("Failed to delete project");const t=n.value.findIndex(i=>i.id===a);t!==-1&&(n.value.splice(t,1),y()),p.success("项目删除成功！")}catch(e){if(e!=="cancel"){console.error("Error deleting project:",e),p.error(`项目删除失败：${e.message}`);const t=n.value.findIndex(i=>i.id===a);t!==-1&&(n.value.splice(t,1),y(),p.success("项目删除成功！(本地模式)"))}}};return oe(()=>{A()}),(a,e)=>{const t=m("el-input"),i=m("el-button"),h=m("el-option"),E=m("el-select"),Z=m("el-skeleton"),F=m("el-tag"),ee=m("el-card"),le=m("el-empty"),f=m("el-form-item"),M=m("el-date-picker"),Y=m("el-form"),L=m("el-dialog");return u(),V("div",ne,[b("div",ie,[e[23]||(e[23]=b("h2",null,"毕业设计项目展示",-1)),b("div",ue,[o(t,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=l=>S.value=l),placeholder:"搜索项目标题或描述",clearable:"",class:"search-input",onInput:y},null,8,["modelValue"]),re(W)?(u(),g(i,{key:0,type:"primary",onClick:e[1]||(e[1]=l=>w.value=!0)},{default:r(()=>[...e[21]||(e[21]=[v(" 添加项目 ",-1)])]),_:1})):(u(),g(i,{key:1,type:"primary",onClick:e[2]||(e[2]=l=>a.$router.push("/auth"))},{default:r(()=>[...e[22]||(e[22]=[v(" 登录后添加项目 ",-1)])]),_:1}))])]),P.value?I("",!0):(u(),V("div",pe,[o(E,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=l=>D.value=l),placeholder:"选择分类",clearable:"",onChange:y,class:"category-select"},{default:r(()=>[o(h,{label:"全部",value:""}),(u(!0),V(j,null,C($.value,l=>(u(),g(h,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(E,{modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=l=>T.value=l),placeholder:"排序方式",onChange:y,class:"sort-select"},{default:r(()=>[(u(!0),V(j,null,C(z.value,l=>(u(),g(h,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])),P.value?(u(),g(Z,{key:1,rows:3,animated:""})):(u(),V("div",ce,[b("div",ve,[(u(!0),V(j,null,C(x.value,l=>(u(),g(ee,{shadow:"hover",class:N(["project-card",{pinned:l.isPinned}]),key:l.id},{header:r(()=>[b("div",fe,[b("h3",null,_(l.title),1),o(i,{type:"text",class:N({pinned:l.isPinned}),onClick:R=>G(l.id)},{default:r(()=>[v(_(l.isPinned?"取消顶置":"顶置"),1)]),_:2},1032,["class","onClick"])])]),default:r(()=>[b("p",me,_(l.description),1),b("div",ge,[o(F,{size:"small"},{default:r(()=>[v(_(l.author),1)]),_:2},1024),o(F,{size:"small",type:"info"},{default:r(()=>[v(_(l.date),1)]),_:2},1024),o(F,{size:"small",type:"success"},{default:r(()=>[v(_(l.category),1)]),_:2},1024)]),b("div",ye,[o(i,{type:"primary",onClick:R=>H(l.id)},{default:r(()=>[...e[24]||(e[24]=[v(" 查看详情 ",-1)])]),_:1},8,["onClick"]),l.id>3?(u(),g(i,{key:0,type:"warning",onClick:R=>Q(l)},{default:r(()=>[...e[25]||(e[25]=[v(" 编辑 ",-1)])]),_:1},8,["onClick"])):I("",!0),l.id>3?(u(),g(i,{key:1,type:"danger",onClick:R=>X(l.id)},{default:r(()=>[...e[26]||(e[26]=[v(" 删除项目 ",-1)])]),_:1},8,["onClick"])):I("",!0)])]),_:2},1032,["class"]))),128))])])),!P.value&&n.value.length===0?(u(),g(le,{key:3,description:"暂无项目数据"})):I("",!0),o(L,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=l=>w.value=l),title:"添加项目",width:"500px"},{footer:r(()=>[o(i,{onClick:e[11]||(e[11]=l=>w.value=!1)},{default:r(()=>[...e[27]||(e[27]=[v("取消",-1)])]),_:1}),o(i,{type:"primary",onClick:J},{default:r(()=>[...e[28]||(e[28]=[v("确定",-1)])]),_:1})]),default:r(()=>[o(Y,{ref_key:"formRef",ref:U,model:d.value,rules:B,"label-width":"100px",class:"add-project-form"},{default:r(()=>[o(f,{label:"标题",prop:"title"},{default:r(()=>[o(t,{modelValue:d.value.title,"onUpdate:modelValue":e[5]||(e[5]=l=>d.value.title=l),placeholder:"请输入项目标题"},null,8,["modelValue"])]),_:1}),o(f,{label:"描述",prop:"description"},{default:r(()=>[o(t,{type:"textarea",modelValue:d.value.description,"onUpdate:modelValue":e[6]||(e[6]=l=>d.value.description=l),rows:4,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),o(f,{label:"分类",prop:"category"},{default:r(()=>[o(E,{modelValue:d.value.category,"onUpdate:modelValue":e[7]||(e[7]=l=>d.value.category=l),placeholder:"选择项目分类",class:"full-width"},{default:r(()=>[(u(!0),V(j,null,C($.value,l=>(u(),g(h,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"GitHub URL"},{default:r(()=>[o(t,{modelValue:d.value.githubUrl,"onUpdate:modelValue":e[8]||(e[8]=l=>d.value.githubUrl=l),placeholder:"请输入项目GitHub链接"},null,8,["modelValue"])]),_:1}),o(f,{label:"作者",prop:"author",hidden:""},{default:r(()=>[o(t,{modelValue:d.value.author,"onUpdate:modelValue":e[9]||(e[9]=l=>d.value.author=l),placeholder:"请输入作者姓名"},null,8,["modelValue"])]),_:1}),o(f,{label:"日期",prop:"date"},{default:r(()=>[o(M,{modelValue:d.value.date,"onUpdate:modelValue":e[10]||(e[10]=l=>d.value.date=l),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(L,{modelValue:k.value,"onUpdate:modelValue":e[20]||(e[20]=l=>k.value=l),title:"编辑项目",width:"500px"},{footer:r(()=>[o(i,{onClick:e[19]||(e[19]=l=>k.value=!1)},{default:r(()=>[...e[29]||(e[29]=[v("取消",-1)])]),_:1}),o(i,{type:"primary",onClick:K},{default:r(()=>[...e[30]||(e[30]=[v("确定",-1)])]),_:1})]),default:r(()=>[o(Y,{ref_key:"editFormRef",ref:O,model:s.value,rules:B,"label-width":"100px",class:"add-project-form"},{default:r(()=>[o(f,{label:"标题",prop:"title"},{default:r(()=>[o(t,{modelValue:s.value.title,"onUpdate:modelValue":e[13]||(e[13]=l=>s.value.title=l),placeholder:"请输入项目标题"},null,8,["modelValue"])]),_:1}),o(f,{label:"描述",prop:"description"},{default:r(()=>[o(t,{type:"textarea",modelValue:s.value.description,"onUpdate:modelValue":e[14]||(e[14]=l=>s.value.description=l),rows:4,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),o(f,{label:"分类",prop:"category"},{default:r(()=>[o(E,{modelValue:s.value.category,"onUpdate:modelValue":e[15]||(e[15]=l=>s.value.category=l),placeholder:"选择项目分类",class:"full-width"},{default:r(()=>[(u(!0),V(j,null,C($.value,l=>(u(),g(h,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"GitHub URL"},{default:r(()=>[o(t,{modelValue:s.value.githubUrl,"onUpdate:modelValue":e[16]||(e[16]=l=>s.value.githubUrl=l),placeholder:"请输入项目GitHub链接"},null,8,["modelValue"])]),_:1}),o(f,{label:"作者",prop:"author",hidden:""},{default:r(()=>[o(t,{modelValue:s.value.author,"onUpdate:modelValue":e[17]||(e[17]=l=>s.value.author=l),placeholder:"请输入作者姓名"},null,8,["modelValue"])]),_:1}),o(f,{label:"日期",prop:"date"},{default:r(()=>[o(M,{modelValue:s.value.date,"onUpdate:modelValue":e[18]||(e[18]=l=>s.value.date=l),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Pe=te(be,[["__scopeId","data-v-fcda0adc"]]);export{Pe as default};
