import{_ as U,u as q,r as m,o as A,c as x,a as l,b as t,d as k,e as d,w as s,f,p as T,g as r,h as D,F as I,i as M,E as v,j as O,k as g,t as i,l as z,s as J,v as L,m as G}from"./index-o71zQlQf.js";const H={class:"forum"},K={class:"forum-header"},Q={class:"forum-content"},W={class:"posts-list"},X={class:"post-header"},Y={class:"post-title"},Z={class:"post-meta"},ee={class:"post-author"},te={class:"post-date"},oe={class:"post-category"},le={class:"post-excerpt"},se={class:"post-stats"},ae={class:"stat-item"},ne={class:"stat-item"},re={class:"stat-item"},ue={class:"post-actions"},ie={__name:"Forum",setup(de){const $=O(),{isAuthenticated:P}=q(),b=m([]),w=m(!1),c=m(!1),n=m({title:"",content:"",category:""}),y=m(null),B={title:[{required:!0,message:"请输入帖子标题",trigger:"blur"}],content:[{required:!0,message:"请输入帖子内容",trigger:"blur"}],category:[{required:!0,message:"请选择帖子分类",trigger:"blur"}]},E=a=>{$.push(`/forum/${a}`)},V=async()=>{w.value=!0;try{const a=await fetch("/forum");if(a.ok){const e=await a.json();b.value=e}}catch(a){console.error("Error fetching posts:",a),v.error("获取帖子失败，请重试！")}finally{w.value=!1}},F=async()=>{if(!y.value){v.error("表单引用错误！");return}try{await y.value.validate();const a=localStorage.getItem("token"),e=await fetch("/forum",{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify({title:n.value.title,content:n.value.content,category:n.value.category})});if(e.ok)await V(),c.value=!1,v.success("帖子发布成功！"),n.value={title:"",content:"",category:""},y.value.resetFields();else{const u=await e.json();v.error(u.message||"帖子发布失败，请重试！")}}catch(a){console.error("Error creating post:",a),v.error("帖子发布失败，请重试！")}};return A(()=>{V()}),(a,e)=>{const u=r("el-icon"),p=r("el-button"),j=r("el-card"),C=r("el-input"),h=r("el-form-item"),_=r("el-option"),N=r("el-select"),R=r("el-form"),S=r("el-dialog");return g(),x("div",H,[l("div",K,[e[9]||(e[9]=l("h2",null,"毕业设计论坛",-1)),e[10]||(e[10]=l("p",{class:"forum-description"},"讨论毕业设计相关问题，分享经验和资源",-1)),d(P)?(g(),k(p,{key:0,type:"primary",onClick:e[0]||(e[0]=o=>c.value=!0)},{default:s(()=>[t(u,null,{default:s(()=>[t(d(T))]),_:1}),e[7]||(e[7]=f(" 发布新帖子 ",-1))]),_:1})):(g(),k(p,{key:1,type:"primary",onClick:e[1]||(e[1]=o=>a.$router.push("/auth"))},{default:s(()=>[t(u,null,{default:s(()=>[t(d(D))]),_:1}),e[8]||(e[8]=f(" 登录后发布帖子 ",-1))]),_:1}))]),l("div",Q,[l("div",W,[(g(!0),x(I,null,M(b.value,o=>(g(),k(j,{shadow:"hover",class:"post-card",key:o.id},{header:s(()=>[l("div",X,[l("h3",Y,i(o.title),1),l("div",Z,[l("span",ee,i(o.author),1),l("span",te,i(o.date),1),l("span",oe,i(o.category),1)])])]),default:s(()=>[l("p",le,i(o.content.substring(0,150))+"...",1),l("div",se,[l("div",ae,[t(u,null,{default:s(()=>[t(d(z))]),_:1}),l("span",null,i(o.comments),1)]),l("div",ne,[t(u,null,{default:s(()=>[t(d(J))]),_:1}),l("span",null,i(o.likes),1)]),l("div",re,[t(u,null,{default:s(()=>[t(d(L))]),_:1}),l("span",null,i(o.views),1)])]),l("div",ue,[t(p,{type:"primary",onClick:ce=>E(o.id)},{default:s(()=>[t(u,null,{default:s(()=>[t(d(G))]),_:1}),e[11]||(e[11]=f(" 查看详情 ",-1))]),_:1},8,["onClick"])])]),_:2},1024))),128))])]),t(S,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=o=>c.value=o),title:"发布新帖子",width:"600px"},{footer:s(()=>[t(p,{onClick:e[5]||(e[5]=o=>c.value=!1)},{default:s(()=>[...e[12]||(e[12]=[f("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:F},{default:s(()=>[...e[13]||(e[13]=[f("发布帖子",-1)])]),_:1})]),default:s(()=>[t(R,{ref_key:"formRef",ref:y,model:n.value,rules:B,"label-width":"100px",class:"create-post-form"},{default:s(()=>[t(h,{label:"标题",prop:"title"},{default:s(()=>[t(C,{modelValue:n.value.title,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.title=o),placeholder:"请输入帖子标题"},null,8,["modelValue"])]),_:1}),t(h,{label:"分类",prop:"category"},{default:s(()=>[t(N,{modelValue:n.value.category,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.category=o),placeholder:"选择帖子分类"},{default:s(()=>[t(_,{label:"技术讨论",value:"技术讨论"}),t(_,{label:"经验分享",value:"经验分享"}),t(_,{label:"资源共享",value:"资源共享"}),t(_,{label:"问题求助",value:"问题求助"}),t(_,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"内容",prop:"content"},{default:s(()=>[t(C,{type:"textarea",modelValue:n.value.content,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.content=o),rows:8,placeholder:"请输入帖子内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},_e=U(ie,[["__scopeId","data-v-d1c3b607"]]);export{_e as default};
