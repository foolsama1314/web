import{_ as N,u as S,r as _,n as E,q as A,o as T,c as P,a as t,b as o,w as a,t as n,g as i,e as d,l as q,s as M,v as O,f as w,x as z,F as D,i as J,d as g,y as L,h as U,j as G,k as p,E as h}from"./index-o71zQlQf.js";const H={class:"forum-post"},K={class:"post-container"},Q={class:"post-content"},W={class:"post-header"},X={class:"post-title"},Y={class:"post-meta"},Z={class:"post-author"},tt={class:"post-date"},et={class:"post-category"},st={class:"post-body"},ot={class:"post-stats"},at={class:"stat-item"},nt={class:"stat-item"},lt={class:"stat-item"},rt={class:"post-actions"},ct={class:"comments-section"},dt={class:"comments-title"},it={class:"comments-list"},ut={class:"comment-header"},mt={class:"comment-author"},_t={class:"comment-date"},pt={class:"comment-content"},ft={class:"add-comment"},vt={__name:"ForumPost",setup(ht){const f=A();G();const{isAuthenticated:V}=S(),k=_([]),y=_([]),b=_(!0),r=E(()=>{const s=parseInt(f.params.id);return k.value.find(e=>e.id===s)||{id:0,title:"帖子不存在",content:"该帖子可能已被删除或不存在。",author:"",date:"",category:"",comments:0,likes:0,views:0}});E(()=>{const s=parseInt(f.params.id);return y.value.filter(e=>e.postId===s)});const u=_({content:""}),v=_(null),j={content:[{required:!0,message:"请输入评论内容",trigger:"blur"}]},C=async()=>{try{const s=await fetch("/forum");if(s.ok){const e=await s.json();k.value=e}}catch(s){console.error("Error fetching posts:",s)}},I=async()=>{try{const s=f.params.id,e=await fetch(`/forum/${s}/comments`);if(e.ok){const l=await e.json();y.value=l}}catch(s){console.error("Error fetching comments:",s)}},x=async()=>{if(!v.value){h.error("表单引用错误！");return}try{await v.value.validate();const s=localStorage.getItem("token"),e=f.params.id,l=await fetch(`/forum/${e}/comments`,{method:"POST",headers:{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}},body:JSON.stringify({content:u.value.content})});if(l.ok)await C(),await I(),h.success("评论提交成功！"),u.value={content:""},v.value.resetFields();else{const m=await l.json();h.error(m.message||"评论提交失败，请重试！")}}catch(s){console.error("Error submitting comment:",s),h.error("评论提交失败，请重试！")}};return T(async()=>{b.value=!0;try{await Promise.all([C(),I()])}finally{b.value=!1}}),(s,e)=>{const l=i("el-icon"),m=i("el-button"),F=i("el-card"),B=i("el-input"),$=i("el-form-item"),R=i("el-form");return p(),P("div",H,[t("div",K,[t("div",Q,[o(F,{shadow:"hover",class:"post-card"},{header:a(()=>[t("div",W,[t("h2",X,n(r.value.title),1),t("div",Y,[t("span",Z,n(r.value.author),1),t("span",tt,n(r.value.date),1),t("span",et,n(r.value.category),1)])])]),default:a(()=>[t("div",st,[t("p",null,n(r.value.content),1)]),t("div",ot,[t("div",at,[o(l,null,{default:a(()=>[o(d(q))]),_:1}),t("span",null,n(r.value.comments)+" 条评论",1)]),t("div",nt,[o(l,null,{default:a(()=>[o(d(M))]),_:1}),t("span",null,n(r.value.likes)+" 个点赞",1)]),t("div",lt,[o(l,null,{default:a(()=>[o(d(O))]),_:1}),t("span",null,n(r.value.views)+" 次浏览",1)])]),t("div",rt,[o(m,{onClick:e[0]||(e[0]=c=>s.$router.push("/forum"))},{default:a(()=>[o(l,null,{default:a(()=>[o(d(z))]),_:1}),e[3]||(e[3]=w(" 返回论坛 ",-1))]),_:1})])]),_:1})]),t("div",ct,[t("h3",dt,n(r.value.comments)+" 条评论",1),t("div",it,[(p(!0),P(D,null,J(y.value,c=>(p(),g(F,{shadow:"hover",class:"comment-card",key:c.id},{default:a(()=>[t("div",ut,[t("span",mt,n(c.author),1),t("span",_t,n(c.date),1)]),t("div",pt,n(c.content),1)]),_:2},1024))),128))]),t("div",ft,[e[6]||(e[6]=t("h4",{class:"add-comment-title"},"添加评论",-1)),o(R,{ref_key:"commentFormRef",ref:v,model:u.value,rules:j,"label-width":"0"},{default:a(()=>[o($,{prop:"content"},{default:a(()=>[o(B,{type:"textarea",modelValue:u.value.content,"onUpdate:modelValue":e[1]||(e[1]=c=>u.value.content=c),placeholder:"写下你的评论...",rows:4},null,8,["modelValue"])]),_:1}),o($,null,{default:a(()=>[d(V)?(p(),g(m,{key:0,type:"primary",onClick:x},{default:a(()=>[o(l,null,{default:a(()=>[o(d(L))]),_:1}),e[4]||(e[4]=w(" 提交评论 ",-1))]),_:1})):(p(),g(m,{key:1,type:"primary",onClick:e[2]||(e[2]=c=>s.$router.push("/auth"))},{default:a(()=>[o(l,null,{default:a(()=>[o(d(U))]),_:1}),e[5]||(e[5]=w(" 登录后评论 ",-1))]),_:1}))]),_:1})]),_:1},8,["model"])])])])])}}},wt=N(vt,[["__scopeId","data-v-30f91012"]]);export{wt as default};
